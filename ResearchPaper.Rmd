---
title: 'Collaborative Research: Spatial Distribution of Crime as a Function of the
  Demarcation of Police Power'
author: "Fabian Bohnenberger and Sebastian Martinez"
date: "December 11, 2015"
output: html_document
bibliography: literature/crimemapping_literature.bib
---

```{r library and wd, include=FALSE}
 
## NOTE: Running this file may take a few minutes because R will load ~340.000 observations (crime in the year 2012).

## Working Directory ##

# Create list of used working directories
possible_dir <- c('C:/Users/Fabian/Documents/GitHub/CrimeMapping2', '/Users/SebastianMartinez/Dropbox/0. Hertie/3/Collaborative Social Science Data Analysis/GitHub/CrimeMapping2/')

# Set to first valid directory in the possible_dir vector
repmis::set_valid_wd(possible_dir)

## Loading required packages ## 

# If this file does not run, check/install required r packages.
library(repmis)
library(rio)
library(RSocrata)
library(foreign)
library(rio)
library(plyr)
library(GISTools)
library(rgeos)
library(knitr)
library(maptools)
library(ggmap)
library(ggplot2)
library(stargazer)

```



```{r setup, include=FALSE}
## knitr caching options
##knitr::opts_chunk$set(cache=TRUE)
```


## Summary 

This research project shows the relationship between the spatial distribution of crimes and the allocation and demarcation of police power in the city of Chicago.


The motivation for this research stems from the way a city is divided into organizational districts, invisible to pedestrians, but potentially limiting in the way police can effectively carry out their duty. 
...


## Introduction 

Every community deals with the presence of crime. Criminal activity has a multitude of causes and the origins of crime have been the subject of investigation by many disciplines. The organization of law enforcement's response is a key factor in understanding the nature and extent of crime occurring in a specific area. For example, one city may be better at fighting crime because it has correctly identified hotspots and distributed its police forces accordingly. This often includes setting up police stations in trouble zones or adjusting police district and beat boundaries to better allocate existing forces.

This research project aims at tracking the relation between the location of reported crimes in a city and the spatial distribution and demarcation of police power. We especially focus on the location of police stations and police districts across the city. By looking at crime as a function of the distance to police stations and district borders, we analyze whether certain crimes are more likely to be perpetrated at the district borders and whether the average distance of certain crimes to either the police stations or boundary is particularly relevant. If, for example, hotspots for certain crimes were located predominantely at the district border, this could indicate coordination problems between adjoining police forces and higher police presence in the center of district. Crimes directed against property, not persons, or criminal activity that includes a monetary transaction and is often organized (narcotics trade and prostitution) may also be located farther away from the police station than, for example, "crimes of passion". Controlling for other factors - especially socioeconomic conditions -, differences in crime levels at the district borders could thus indicate different levels of cooperation between police districts and different force allocations inside a given district. 


## Literature Overview and Relevance of Research

The origins of crime have been the subject of investigation by many disciplines. A significant amount of the literature has looked at socioeconomic conditions to explain the occurence of urban crime. @Blau1982, for example, finds that "socioecconomic inequality between races, as well as economic inequality generally, increases the rates of criminal violence". @Delbecq, in their analysis of Chicago crime, see criminal activity "rooted in a lack or a weakening of social control exerted by communities because of poverty, residential instability and racial/ethnic heterogeneity". However, an increasing amount of literature, for example @Charron2009, includes spatial characteristics of neighborhoods and districts, including urban structure, urbanisation levels, land/zone use, the presence of graffiti, garbage and run-down buildings, employment density, pollution, availability of public transport, and other variables in their analysis.

Some literature has looked primarily at the effects of a city's spatial characteristics on crime. Described in a more conceptual manner, a city is not only set of objects and buildings placed one next to the other, but a set of places with specific functions designed for its citizens. The inhabitants interact with the physical space and vice versa; thus shaping both available actions as well as surrounding structure. For example, researchers have found that a denser, mixed-use neighborhood has a smaller number of crime occurrences than a sprawled, more spread out neighborhood. @Morenoff:1997ux specifically show that crime has a spatial component, often ignored by social researchers. They also argue that depending on the physical structure of a city, areas with high crime can spread out to neighboring areas in a process called "spatial diffusion of crime". Further, @Rosenfeld:1999vv found that when controlling for neighborhood demographic characteristics, the spatial distribution of crime is due to both the intrinsic characteristics of gang culture and the facilitating neighborhood characteristics. @Leenders:2002fa, for example, builds on this research in his calculation of "weights matrices" to determine the use composition of a block, but also its relation with neighboring blocks, to allow for empirical research on the diffusion effects of crime. 

Other research, especially criminological literature, focuses more on the operative part of crime prevention, but also relies heavily on the research on the effects of spatial characteristics. The "Broken Windows Theory" postulated by James Q. Wilson and George Kelling in 1982 in an influential article in the Atlantic Monthly represents an important starting point. @Wilson suggest that targeting minor disorder, e.g. vandalism and broken windows, could help reduce more serious crime. The theory assumes that the landscape "communicates" to people. A broken window transmits to criminals the message that a community displays a lack of informal social control, and is therefore unable or unwilling to defend itself against a criminal invasion. In more recent literature, this theory is, however criticized for its simplicity. Acccording to @Harcourt, evidence from New York City crime data and from social experiments in five US cities would "provide no support for a simple first-order disorder-crime relationship as hypothesized by Wilson and Kelling, nor for the proposition that broken windows policing is the optimal use of scarce law enforcement resources."

While urban hotspots of crime are often well documented, there has been, according to @Zipkin2014, only limited research on "optimal and dynamically adapting police responses to changing crime patterns". By looking at the the City of Chicago's data, we aim to contribute to the research that tries to understand optimal police responses both on the operative as well as on the organizational level. 


## Research Question / Hypotheses 

Our research aims to show the relationship between the spatial distribution of crimes and the allocation and demarcation of police power in the city of Chicago. We operationalize the concept of "demarcation of police power" in two ways: First, we measure the distance between crime scene and the physical location of the police station. Second, we measure the distance between the crime scene and the calculated center of the district. This provides an approximation of the distance of the crime to the district border, which is otherwise difficult and hardware-intensive to calculate. The motivation for this research stems from the way a city is divided into organizational districts, invisible to pedestrians, but potentially limiting in the way police can effectively carry out their duty.   

### Research Question 

Our key research question is: *Does the physical location of police stations and the organizational demarcation of police districts have a statistically significant effect on the spatial distribution of crime in the city of Chicago?*

### Hypotheses 

The proposed research questions are connected to the following hypotheses:

**Hyptohesis 1**: The farther away from the police station, the more crimes are committed. 

**Hypothesis 2**: Specific crimes are mostly perpetrated near the district borders; their chance to occur closer to police stations is low. 


## Methodology

The proposed methodology is to run different regression models (linear and probit) to analyse the relationship between the occurence of crime and the distribution of police power in Chicago. The idea is that depending on the active presence of police in a district, criminals might have incentives to move away from the places where the police is present, especially around the police station. In other words, this research is trying to explain the development of crime hotspots in relation to the organizational distribution of responsibility to specific police forces in a city. The data sources, as well as the necessary transformations are described in this chapter. This will be accompanied by descriptive statistics that outline the 2012 crime data in Chicago. Following the presentation of the data, we develop different regression models to identify crime types that occur closer at the district borders/farther from the polics station of each district. We use two types of regressions: Probit models based on a dummy variable that distinguishes between "Close" and "Far" Crimes depending on a circle drawn around the police station (which will be described in more detail below) and Linear models that use the absolute distance between crimes and the police station as the dependent variable.  


### Data Collection 

The main source for accessing data for this research project is the [Data Portal of the City of Chicago](data.cityofchicago.org). The website provides access to government data on the City departments, services, facilities and performance. The [Socrata Open Data API](https://github.com/chicago) can be used to load the data directly into R. To import the information, we rely on R's "Rio" package, which features the "import" function.

#### Overview of data used in this project and data limitations

Because of data limitations on our control variables, our research focuses on the year 2012. For this year, Census data is available on the Data Portal that provides a more comprehensive overview of the socioeconomic characteristics. More recent data on the control variables is only partially available from 2012 to present. Therefore, this research project focused on crime data of the year 2012, which amounts to about 335.000 observations for the City of Chicago, and uses available Census Data of the same year as control variables. 

1. Crime Data (available 2001 to present)

This [dataset on crime in Chicago](https://data.cityofchicago.org/Public-Safety/Crimes-2001-to-present/ijzp-q8t2) includes information on all crimes that were reported in the city from 2001 until 2015. It includes the date and time, the "primary type" of the crime (e.g. theft, arson, narcotics), a short description (e.g. type of weapon used, broad indication of the value stolen), and whether there has been an arrest. Additionally, it provides detailed data on the location of the crime, including latitude and longitude as well as in which police beat and district and in which community district the crime occurred. It also includes a specific location description (e.g. sidewalk, office building or school).

2. District and community border data

For our research project, information on borders of police districts and "communities" is crucial. Information on [police districts](https://data.cityofchicago.org/Public-Safety/Boundaries-Police-Districts-current-/fthy-xz3r) is important because we are interested in the spatial distribution of crime as a function of the location of police stations and the organizational delineation of police power. [Community borders](https://data.cityofchicago.org/Facilities-Geographic-Boundaries/Boundaries-Community-Areas-current-/cauq-8yn6) are important because most socioeconomic data available on the Chicago Data Portal is aggregated on the community level. This does also include information on age distributions, health, as well as organizational statistics like abandoned buildings, land use and energy consumption. 

3. Control variables (including socioeconomic data, 2008-2012)

In the regression models, we need to control for the specific characteristics of the police districts in question that affect crime. Economic and demographic factors in each city area (community level data) must be considered, as well as other imortant variables. The City of Chicago Data Portal offers information on the following characteristics of communities: 

  - [Census Data 2008-2012](https://data.cityofchicago.org/Health-Human-Services/Census-Data-Selected-socioeconomic-indicators-in-C/kn9c-c2s2), especially focusing on certain socioeconomic indicators (percent of housing crowded, percent households below poverty line, percentage aged 16+ unemployed, percentage aged 25+ without highschool diploma, percentage aged under 18 or over 64, per capita income, and a weighted "hardship index". Further explanation on the dataset can be accessed [here](https://data.cityofchicago.org/api/views/fwb8-6aw5/files/A5KBlegGR2nWI1jgP6pjJl32CTPwPbkl9KU3FxlZk-A?download=true&filename=P:\EPI\OEPHI\MATERIALS\REFERENCES\ECONOMIC_INDICATORS\Dataset_Description_socioeconomic_indicators_2012_FOR_PORTAL_ONLY.pdf)  
  
  - Additional information on the community level can be found in this [public health statistics dataset](https://data.cityofchicago.org/Health-Human-Services/Public-Health-Statistics-Selected-public-health-in/iqnk-2tcu), which not only provides information on birth rates and a number of diseases, but also lists environment or poverty-related diseases (e.g. childhood lead poisoning), the teen birth rate and includes data on unemployment levels on the community level. This [dataset](https://data.cityofchicago.org/Health-Human-Services/Public-Health-Statistics-Life-Expectancy-By-Commun/qjr3-bm53) provides additional information on the life expectancy on the community level. 
  
  - The City of Chicago also offers information on police funding over the years on a district level. It is, however, not easily discernible whether year-to-year budget changes are actually funding active police work or are, for example, necessary to cover pensions. Also, the allocation of funding to specific districts cannot be fully ascertained based on the provided data. It is therefore not used in this analysis. 
  
  - There are, however, some factors that are not readily measurable or for which no data exists. In these cases, we need to make indirect assumptions (e.g. citizens attitude towards crime, crime reporting practices of the citizenry, family cohesiveness, cultural characteristics) @FBI offers a comprehensive list of factors that are known to affect the volume and type of crime. 


#### Data collection 

Data is collected using R's "Rio" package. Alternatively, one can also rely on the City of Chicago Data Portal's recommended "RSocrata" package. All data used in this project is also available in its original format on our Repository on GitHub. 

```{r, echo=FALSE}
## R code to import the respective data files is sourced from TWO separate R file. The first one contains the crime data. NOTE that running this file may take a short while because R will load ~340.000 crime observations for the year 2012. The second contains import code for all other data. 
## This file sources the required data files from our Github repository. The data files are identical to those on the City of Chicago Data Portal. 

## Crime Data (NOTE: May take a few minutes)
source('RSourceFiles/DataImportCrime.R')

## Border Data & Controls 
source('RSourceFiles/DataImportRest.R')

```


#### Calculating District Centers 

As described above, an important first step for our analysis is the calulcation of the police district centers. This provides us with an approximation of each crimes' distance to the district border. In addition, we prepare the data on the location of police stations. 

```{r Calculating district centers, echo=FALSE}

## To access the information contained in the shapefiles, the .dbf file is used. 
## The shapefiles are loaded into R, and the Centroids of the polygons are calculated. 
boundaries <- read.dbf("RSourceFiles/PoliceDistrict.dbf")
sids <- readShapePoly("RSourceFiles/PoliceDistrict.shp")
PoliceDistrictCentroids = as.data.frame(gCentroid(sids,byid=TRUE))
stations <- read.dbf("RSourceFiles/PoliceStationsDec2012.dbf")
stations_ <- readShapePoints("RSourceFiles/PoliceStationsDec2012.shp")
stations = as.data.frame(stations_)
```

**Map 1** shows a plot with the map of Chicago. It is divided into Police Districts, the centroids of every district are presented in circles. The location of each police station is represented by a triangle. 

**Map 1**

```{r Plot Police Districts and Stations, echo=FALSE}

## A plot of the districts with the centroids is generated
plot(sids)
points(coordinates(stations_), pch=1)
points(coordinates(sids),pch=2)

```


```{r , echo=FALSE}

## Information is saved onto the boundaries data frame to be then merged with the additional information
boundaries$centroid_x <- PoliceDistrictCentroids$x
boundaries$centroid_y <- PoliceDistrictCentroids$y


# Similarly, information on the boundaries of the communities is added. 
commareas_dbf <- read.dbf("RSourceFiles/CommAreas.dbf")
commareas <- readShapePoly("RSourceFiles/CommAreas.shp")
CommAreasCentroids <- as.data.frame(gCentroid(commareas,byid=TRUE))
```

As a second step, we have to compare the police districts with the delineation of "communities" in Chicago. This is important because the socioeconomic data that will be used in our regression is based on this aggregation level. As **Map 2** shows, the Community Districts are different from the Police Districts. The figure also includes the centers of the respective community districts. We will therefore have to be careful in the following analysis to link the socioeconomic conditions on the community level to the crimes in question, which are reported by police district. To link each crime with the relevant socioeconomic information, we rely on the community code that is included in the crime dataset. 

**Map 2**

```{r, echo=FALSE}

## A plot of the community districts with the centroids is generated
plot(commareas)
points(CommAreasCentroids,pch=1)

## Information is saved onto the boundaries data frame to be then merged with the additional information
commareas_dbf$centroid_x <- CommAreasCentroids$x
commareas_dbf$centroid_y <- CommAreasCentroids$y
```


#### Merging the Data

To connect the datasets mentioned above and include the relevant information on district centers, we merge the relevant data in a two step process. First, the crime and census data are merged based on the "community area" code that is used in both datasets. Second, the data on police districts and community areas with their respective centroids is merged with the crime and census data. 

```{r, echo=FALSE}

## A new dataframe named "total" is created that contains all crime and census data. NOTE: Requires loading crime data!
## Contains 335481 obs. and 30 var. 
total <- merge(crimes, census, by.x = "Community.Area", by.y = "ca")

```

```{r Merging and Renaming 1, echo=FALSE}

## Data from the boundaries and the community areas with their respective centroids is merged with the crime and census data
total <- merge(total, boundaries, by.x = "District", by.y = "DIST_NUM")
total <- merge(total, commareas_dbf, by.x = "Community.Area", by.y = "AREA_NUM_1")
total <- merge(total, stations, by.x = "District", by.y = "DIST")

### Renaming of coordinates 
total$center_x <- total$centroid_x.y
total$center_y <- total$centroid_y.y
total$x <- total$X.Coordinate
total$y <- total$Y.Coordinate
total$st_location_x <- total$coords.x1
total$st_location_y <- total$coords.x2

## Result: "total" dataframe contains 57 var. 

```

### Calculating the Distance of Crimes to District Center and Police Station

To determine which crimes occur closer to the border of each district, and hence farther away from the location of the police station for that district, we calculate two distances: First, based on our calculations of the police district centers, we estimate the distance between the location of each crime and the center of the police district. Second, we determine the distance between the crime scene and the police station. 

We calculate both distances in two ways: 

1. The absolute distance of each crime to the district's center.

2. The relative distance based on the crime in each district that is farthest away from the district's center. The relative distance is calculated as the distance of every crime to the center divided by the distance of the crime that is the farthest away from the center of the district. This allows us to understand the position of every crime in relation to the police district where it occurred, instead of a level measurement. 

```{r Absolute Distance, echo=FALSE}

# Absolute Distance
## The Distance from the place where a crime was committed to the center of the police district is calculated. 

total$y_dist <- total$y - total$center_y
total$x_dist <- total$x - total$center_x
total$x_st_dist <- total$x - total$st_location_x
total$y_st_dist <- total$y - total$st_location_y
total$distance <- sqrt((total$x_dist)^2+(total$y_dist)^2)
total$distance_sta <- sqrt((total$x_st_dist)^2+(total$y_st_dist)^2)
total$count <- 1
# NA values for distance are omitted from the analysis
total <- total[!(is.na(total$distance)),]
total <- total[!(is.na(total$distance_sta)),]


#Establishing two counters for loops (Strangely, one loop does not cover all districts.)
total_1 <- total[(total$District<=10),] 
total_2 <- total[(total$District>10),] 

counter_1 <- aggregate(count ~ District, data = total_1, FUN=mean)
counter_2 <- aggregate(count ~ District, data = total_2, FUN=mean)

```

```{r Relative Distance Loop, echo=FALSE}

# Relative Distance
## To determine the relative distances (crime farthest away=1)

## Data has to be adapted because distance needs to be calculated for each district separately. 

### Loops to split the data set into smaller datasets, one for every district
district_list <- list()
district_list_2 <- list()
for(i in counter_1$District) 
{
  temp <- total_1[total_1[,1]==i,]
  nam <- paste("District", i, sep = "")
  assign(nam, temp)
  district_list[[nam]] <- temp
}

### Max distance is calculated and included into the data set
for(i in counter_1$District) 
{
  print(i)
  nam <- paste("District", i, sep = "")
  #print(nam)
  temp <- district_list[[nam]]
  temp$max_distance <- max(abs(temp$distance))
  temp$max_distance_sta <- max(abs(temp$distance_sta))
  assign(nam, temp)
  temp
  district_list[[nam]] <- temp
}

### Loop to split the data set into smaller datasets, one for every district
district_list_2 <- list()
for(i in counter_2$District) 
{
  temp <- total_2[total_2[,1]==i,]
  nam <- paste("District", i, sep = "")
  assign(nam, temp)
  district_list_2[[nam]] <- temp
}

### Max distance is calculated and included into the data set
for(i in counter_2$District) 
{
  print(i)
  nam <- paste("District", i, sep = "")
  #print(nam)
  temp <- district_list_2[[nam]]
  temp$max_distance <- max(abs(temp$distance))
  temp$max_distance_sta <- max(abs(temp$distance_sta))
  assign(nam, temp)
  temp
  district_list_2[[nam]] <- temp
}


### Different data frames are appended into a single big data set again. 
Crime_Data_1 <- ldply(district_list, data.frame, inform=TRUE)
Crime_Data_2 <- ldply(district_list_2, data.frame, inform=TRUE)

counter_3 <- aggregate(count ~ District, data = Crime_Data_1, FUN=mean)
counter_4 <- aggregate(count ~ District, data = Crime_Data_2, FUN=mean)

Crime_Data <- rbind.fill(Crime_Data_1,Crime_Data_2)
#Crime_Data <- rbind.fill(Crime_Data,District10)
#Dist10 is already included in total_1, don't add again 

Crime_Data$rel_dist <- Crime_Data$distance/Crime_Data$max_distance
Crime_Data$rel_dist_sta <- Crime_Data$distance/Crime_Data$max_distance_sta
#Crime_Data <- Crime_Data[order(Crime_Data$rel_dist),]
```


## Descriptive statistics 

This section is used to describe the data on which our analysis is based and present trends and interesting cases on an aggregated (across districts) and disaggregated level. We also test the explanatory value of the *relative* distance calculation in this section. 

### Aggregate Crime Statistics

```{r Collapse Data Frame, echo=FALSE}
# Aggregate descriptive statistics
## A "Collapse" is done on the relative distance by District and by typ of crime, and then
## only to types of crime to see if there is a relationship between their occurence in relation to the 
## border of the district. 

agg_crime_type <- aggregate(rel_dist ~ District*Primary.Type, data=Crime_Data, FUN=mean)
agg_crime_type$number <- aggregate(count ~ District*Primary.Type, data=Crime_Data, FUN=sum)
agg_crime <- aggregate(rel_dist ~ Primary.Type, data=agg_crime_type, FUN=mean)
agg_crime_count <- aggregate(count ~ Primary.Type, data=Crime_Data, FUN=sum)
agg_crime <- merge(agg_crime, agg_crime_count, by = "Primary.Type")
agg_crime <- agg_crime[order(agg_crime$rel_dist),]

#to compare the two files manually:
#write.csv(agg_crime, "agg_crime.csv")



## This section repeats the same for the distance between crime and police station. 

agg_crime_type_sta <- aggregate(rel_dist_sta ~ District*Primary.Type, data=Crime_Data, FUN=mean)
agg_crime_type_sta$number <- aggregate(count ~ District*Primary.Type, data=Crime_Data, FUN=sum)
agg_crime_sta <- aggregate(rel_dist_sta ~ Primary.Type, data=agg_crime_type_sta, FUN=mean)
agg_crime_sta_count <- aggregate(count ~ Primary.Type, data=Crime_Data, FUN=sum)
agg_crime_sta <- merge(agg_crime_sta, agg_crime_sta_count, by = "Primary.Type")
agg_crime_sta <- agg_crime_sta[order(agg_crime_sta$rel_dist_sta),]

#to compare the two files manually:
#write.csv(agg_crime_sta, "agg_crime_sta.csv")
```


```{r kable, echo=FALSE}
# Creating data for tables on "Aggregate Crime Statistics" (number of crimes and distances) 

table_temp <- agg_crime
table_temp$distance_from_border_type <- agg_crime$Primary.Type
table_temp$distance_from_border <- agg_crime$rel_dist
table_temp$distance_to_station_type <- agg_crime_sta$Primary.Type
table_temp$distance_to_station <- agg_crime_sta$rel_dist_sta
table_temp$distance_from_border_number <- agg_crime$count
table_temp$distance_to_station_number <- agg_crime_sta$count
subdata1 <- c("distance_from_border_type", "distance_from_border_number")
subdata2 <- c("distance_from_border_type", "distance_from_border", "distance_to_station_type", "distance_to_station")

table1 <- table_temp[subdata1]
table2 <- table_temp[subdata2]

```

**Table 1** shows the types of crimes included in the City of Chicago dataset with the respective number of reported instances for the year 2012. The table presents the data for all districts and all crime types. It is important that  some categories contain very few observations. Therefore, any inferences based on these categories will neccessarily be less statistically significant. We omit these categories in the inferential part of our analysis.

```{r kable Table 1, echo=FALSE}
coltable1 <- c("Crime Types", "Reported Crimes")
kable(as.matrix(table1), digits = 2, caption = "Table 1 - Number of Reported Crimes (All Districts, All Crime Types)", col.names=coltable1) 

#write.csv(table1, "table1.csv")
#write.csv(table2, "table2.csv")

## , row.names = NA, col.names = colnamesTable1(Crime_Types, Reported_Crimes)
```

**Table 2** presents the *relative* distance between crime scene and police station as well as the *relative* distance between crime scene and the calculated police district center. The table again shows all crime types and presents the average across all districts. 

The first and third column in **Table 2** show the names of the "Crime Types", while the second and forth columns present the data for the relative distance to the calculated district center and the police station respectively. 

```{r kable Table 2, echo=FALSE}
coltable2 <- c("Crime Types", "Rel. Distance Center", "Crime Types", "Rel. Distance Station")
kable(as.matrix(table2), digits = 2, caption = "Table 2 - Relative Distance to Policy Station and to District Center (Accross All Districts, All Crime Types)", col.names=coltable2) 

```


As shown in **Table 2**, the *relative* distances in both columns are not the same, but lead to overall similar results. Differences occur because the police station is not always located at the center of the district, as was already shown in **Map 1**.

It is interesting to compare which crimes tend to occur farther away from the center of the district, as well as which ones tend to occur farther away from where the stations is located. It is, for example, noteworthy that prostitution, sexual criminal assault and also theft (which is the most prevalent crime in the statistic) seem to occur farther away from the police station or the district center in both measurements. On the other hand, arson, public peace violations and liquor law violations tend to be perpetrated/reported at closer distances to the center. 

However, this aggregated level clearly does not allow for much variation in the relative distances. Most of the observations are clustered around very similar values, which becomes especially visible in **Figure 1**. A closer look at more disaggregated data seems to be necessary to discover spatial patterns of the perpetration of crime on the district level. 

### Disaggregated Crime Statistics 

As **Figure 1** shows, the relative distance for crime types across all districts is not significantly distributed to make inferences about the occurence of specific crimes. We need to look at more disaggregated data to find differences in the spatial distribution of crime. 

**Figure 1 - Relative Distance between Crime Types and District Center across Police Districts**  
```{r, echo=FALSE}

reldist <- as.numeric(agg_crime$rel_dist)
hist(reldist, freq=TRUE, main ="Relative Distance as Average across all Police Districts")
curve(dnorm(x, mean=mean(reldist), sd=sd(reldist)), add=TRUE, col="darkblue", lwd=2) 

```

Looking at the data for each crime type and district separately leads to significant improvements. **Figure 2** includes all average distances that were calculated on a district-by-district basis. We will have to assess differences in the spatial distribution of crime (in terms of distance from the police district center) for individual crimes in a next step. 

**Figure 2 - Relative Distance between Crime Types and District Center for individual Police Districts**
```{r, echo=FALSE}

reldistind <- as.numeric(agg_crime_type$rel_dist)
hist(reldistind, freq=TRUE, main ="Relative Distance for individual Police Districts")
curve(dnorm(x, mean=mean(reldistind), sd=sd(reldistind)), add=TRUE, col="darkblue", lwd=2) 

```

**Figures 3 to 5** present the distribution of average relative distances (per police district) for specific crimes. The graphs show that the relative distance, which corrects for the different size of police districts, is not equal across all police districts. Instead, we see that the average relative distances across the 22 Police Districts in the city of Chicago approximate a normal distribution. 

**Figure 3 - Relative Distance for THEFT across Police Districts**

```{r, echo=FALSE}

SelectedCrimeFigure1 <- subset(agg_crime_type, Primary.Type == "THEFT")

reldistind <- as.numeric(SelectedCrimeFigure1$rel_dist)
hist(reldistind, freq=TRUE, main ="Relative Distance for THEFT")
curve(dnorm(x, mean=mean(reldistind), sd=sd(reldistind)), add=TRUE, col="darkblue", lwd=2) 
```


**Figure 4 - Relative Distance for PROSTITUTION across Police Districts**

```{r, echo=FALSE}
SelectedCrimeFigure2 <- subset(agg_crime_type, Primary.Type == "PROSTITUTION")

reldistind <- as.numeric(SelectedCrimeFigure2$rel_dist)
hist(reldistind, freq=TRUE, main ="Relative Distance for PROSTITUTION")
curve(dnorm(x, mean=mean(reldistind), sd=sd(reldistind)), add=TRUE, col="darkblue", lwd=2) 
```


**Figure 5 - Relative Distance for HOMICIDE across Police Districts**

```{r, echo=FALSE}
SelectedCrimeFigure3 <- subset(agg_crime_type, Primary.Type == "HOMICIDE")

reldistind <- as.numeric(SelectedCrimeFigure3$rel_dist)
hist(reldistind, freq=TRUE, main ="Relative Distance for HOMICIDE")
curve(dnorm(x, mean=mean(reldistind), sd=sd(reldistind)), add=TRUE, col="darkblue", lwd=2) 
```


### Evaluation of relative distance variable 

This section evaluates wheter our caluclation of *relative* distances of certain crimes to the crime farthest away per district adds value to our statistical analysis. As the previous section has already shown, the relative distance helps us account for the different physical sizes of police districts across the city. However, referring back to **Table 2**, the question remains whether the relative distance can actually make a meaningful contribution on a disaggregated level. 

**Figure 6** and **Figure 7** show the same distributions as **Figure 1** and **Figure 2**, but use the distance to the Police Station as the center point. What is evident, again, is that the relative distance does not contribute much value on an agggregate level. Instead, the relative distance should be used on a district-by-district basis. 

**Figure 6 - Relative Distance between Crime Types and District Center across Police Districts**
```{r, echo=FALSE}
reldiststa <- as.numeric(agg_crime_sta$rel_dist_sta)
hist(reldiststa, freq=TRUE, main ="Relative Distance to Police Station")
curve(dnorm(x, mean=mean(reldiststa), sd=sd(reldiststa)), add=TRUE, col="darkblue", lwd=2) 

```

**Figure 7 - Relative Distance between Crime Types and District Center for individual Police Districts**
```{r, echo=FALSE}

reldistindsta <- as.numeric(agg_crime_type_sta$rel_dist_sta)
hist(reldistindsta, freq=TRUE, main ="Relative Distance for individual Police Districts")
curve(dnorm(x, mean=mean(reldistindsta), sd=sd(reldistindsta)), add=TRUE, col="darkblue", lwd=2) 
```

**Figures 8 to 10** show that the relative distance can actually be useful on a district level. While the graphs show relatively low values for districts 1 and 8, the values in district 20 are much more distributed. This indicates that the relative distance as calculated above could actually be a useful way to point to differences in the spatial distribution of crimes between districts. 

**Figure 8 - Average Relative Distances for District 1**
```{r, echo=FALSE}
SelectedCrimeFigure4 <- subset(agg_crime_type, District == "1")

reldistind <- as.numeric(SelectedCrimeFigure4$rel_dist)
hist(reldistind, freq=FALSE, main ="Relative Distance for District 1")
curve(dnorm(x, mean=mean(reldistind), sd=sd(reldistind)), add=TRUE, col="darkblue", lwd=2) 
```

**Figure 9 - Average Relative Distances for District 8**
```{r, echo=FALSE}
SelectedCrimeFigure5 <- subset(agg_crime_type, District == "8")

reldistind <- as.numeric(SelectedCrimeFigure5$rel_dist)
hist(reldistind, freq=FALSE, main ="Relative Distance for District 8")
curve(dnorm(x, mean=mean(reldistind), sd=sd(reldistind)), add=TRUE, col="darkblue", lwd=2) 
```

These examples thus show that the average relative distance for the crime types actually differs across districts. Figure 10 shows a particularly broad distribution.

**Figure 10 - Average Relative Distances for District 20**
```{r, echo=FALSE}
SelectedCrimeFigure6 <- subset(agg_crime_type, District == "20")

reldistind <- as.numeric(SelectedCrimeFigure6$rel_dist)
hist(reldistind, freq=FALSE, main ="Relative Distance for District 20")
curve(dnorm(x, mean=mean(reldistind), sd=sd(reldistind)), add=TRUE, col="darkblue", lwd=2) 
```

### Crime Distribution 

This section presents a more comprehensive overview of the distribution of crime itself. **Map 3** provides an overview of the distribution of crimes across the city of Chicago. The map shows that there are few areas where no crimes are committed. It is also noteworthy that the number of dots representing crimes on the map does not decrease substantially towards the City borders. In that regard, **Map 3** suggests that these borders might not have any statistically significant effect on the spatial distribution of crime. However, it might also indicate that crime moves towards the these borders because the police presence might be lower at the margins of the Police districts. 
 
**Map 3 - All Crimes in Chicago 2012**  

```{r Map All Crimes, echo=FALSE, warnings=FALSE, error=FALSE, results='hide'}

ChicagoMap <- qmap("Chicago", zoom = 10, maptype = "toner", source = "stamen")

FinalMap <- ChicagoMap +
                geom_point(aes(x = Longitude, y = Latitude, colour = Primary.Type),
                data = Crime_Data) +
                #geom_point(aes(x = stations$coords.x1, y = stations$coords.x2), data = stations) +
                xlab('') + ylab('') +
                theme(axis.ticks = element_blank(), 
                      axis.text.x = element_blank(),
                      axis.text.y = element_blank()) + 
                guides(size = guide_legend(title = 'Crime Type'),
                       colour = guide_legend(title = 'Crime Type'))
print(FinalMap)

```

**Map 4** shows the spatial distribution of the most common crimes, theft and battery, in Chicago. The map indicates that these crimes are in fact relatively evenly distributed across the city because there are no real clusters or specific patterns visible. 

**Map 4 - Distribution of Specific Crimes 1**  

```{r Map Most Common Crimes, echo=FALSE, warnings=FALSE, error=FALSE, results='hide'}

SelectedCrimesData1 <- subset(Crime_Data, Primary.Type == "THEFT" | Primary.Type == "BATTERY" )

FinalMap <- ChicagoMap +
                geom_point(aes(x = Longitude, y = Latitude, colour = Primary.Type),
                data = SelectedCrimesData1) +
                #geom_point(aes(x = stations$coords.x1, y = stations$coords.x2), data = stations) +
                xlab('') + ylab('') +
                theme(axis.ticks = element_blank(), 
                      axis.text.x = element_blank(),
                      axis.text.y = element_blank()) + 
                guides(size = guide_legend(title = 'Crime Type'),
                       colour = guide_legend(title = 'Crime Type'))
print(FinalMap)
```

**Map 5** and **Map 6** indicate that other crimes might be distributed more unevenly. This can, for example be shown with Weapons Violations and Public Peace Violations. These seem to be more clustered in specific areas, which also seem to be the districts with the highest population density. Interestingly, they also seem to occur less often at the City border than in the inner city. 

**Map 5 - Distribution of Specific Crimes 2**  

```{r Map Violations, echo=FALSE, warnings=FALSE, error=FALSE, results='hide'}

SelectedCrimesData2 <- subset(Crime_Data, Primary.Type == "PUBLIC PEACE VIOLATION" | Primary.Type == "WEAPONS VIOLATION" )

ChicagoMap <- qmap("Chicago", zoom = 11, maptype = "toner", source = "stamen")

FinalMap <- ChicagoMap +
                geom_point(aes(x = Longitude, y = Latitude, colour = Primary.Type),
                data = SelectedCrimesData2) +
                #geom_point(aes(x = stations$coords.x1, y = stations$coords.x2), data = stations) +
                xlab('') + ylab('') +
                theme(axis.ticks = element_blank(), 
                      axis.text.x = element_blank(),
                      axis.text.y = element_blank()) + 
                guides(size = guide_legend(title = 'Crime Type'),
                       colour = guide_legend(title = 'Crime Type'))
print(FinalMap)
```

**Map 6** shows that some crimes are even more clustered. This relates especially to gambling and prostitution crimes that seem to be located at fewer locations. Prostitution seems to occur primarily along certain streets, while gambling remains concentrated in specific districts. In comparison, sex offenses are not that clustered. The same is true for narcotics related crimes. (Not included in this Map for clarity.)

**Map 6 - Distribution of Specific Crimes 3**  

```{r Map Clustered Crimes, echo=FALSE, warnings=FALSE, error=FALSE, results='hide'}

SelectedCrimesData3 <- subset(Crime_Data, Primary.Type == "SEX OFFENSE" | Primary.Type == "PROSTITUTION" | Primary.Type == "GAMBLING")

FinalMap <- ChicagoMap +
                geom_point(aes(x = Longitude, y = Latitude, colour = Primary.Type),
                data = SelectedCrimesData3) +
                xlab('') + ylab('') +
                theme(axis.ticks = element_blank(), 
                      axis.text.x = element_blank(),
                      axis.text.y = element_blank()) + 
                guides(size = guide_legend(title = 'Crime Type'),
                       colour = guide_legend(title = 'Crime Type'))
print(FinalMap)
```

**Map 7** shows the distribution for three other felony crimes with relatively few observations (Homicide: 97, Kidnapping: 100, Arson: 155) in comparison to other crimes like burglary and theft. Again, we do not really see specific clusters of these crimes. 

**Map 7 - Distribution of Specific Crimes 4**  

```{r Map Specific Felonies, echo=FALSE, warnings = FALSE, error=FALSE, results='hide'}

SelectedCrimesData4 <- subset(Crime_Data, Primary.Type == "HOMICIDE" | Primary.Type == "ARSON" | Primary.Type == "KIDNAPPING")

FinalMap <- ChicagoMap +
                geom_point(aes(x = Longitude, y = Latitude, colour = Primary.Type),
                data = SelectedCrimesData4) +
                #geom_point(aes(x = stations$coords.x1, y = stations$coords.x2), data = stations) +
                xlab('') + ylab('') +
                theme(axis.ticks = element_blank(), 
                      axis.text.x = element_blank(),
                      axis.text.y = element_blank()) + 
                guides(size = guide_legend(title = 'Crime Type'),
                       colour = guide_legend(title = 'Crime Type'))
print(FinalMap)
```



## Inferential Statistics

### Splitting Crimes in Close and Far 

To determine whether the location of the police station has an effect on crime, we first create a dummy variable that distinguishes crimes that are perpetrated close to a police station from crimes that were reported farther away. This approach addresses both research hypotheses that we outlined above. We create a circle with the police station at its center for each district. The radius of the circle is 2/3 the maximal distance, which is determined by the farthest away crime in each district. We chose 2/3 because taking half of the maximum distance would have covered an insufficient area around the police station in comparison to the total area of the district. All crimes that are reported inside this circle are considered "Close", those outside the circle are labled "Far".

```{r Close and Far Crimes Dummy, echo=FALSE}

# We create a variable called "far" (far = 1)
Crime_Data$half_distance  <- 2*Crime_Data$max_distance/3
Crime_Data$far <- ifelse(Crime_Data$distance>=Crime_Data$half_distance,1,0)

## This commented section creates a variable called "close" (close = 1)
#Crime_Data$half_distance  <- 2*Crime_Data$max_distance/3
#Crime_Data$close <- ifelse(Crime_Data$distance>=Crime_Data$half_distance,1,0)

```


### Establishing crime categories 

To compare the effects of the location of the police station on different types of crime, we create different groups of crimes from our data. Although we cannot be sure that all observations represent the group criteria to the fullest degree (e.g. all crimes in the category "violent" necessarily included the application of violence), the categories were created based on widely-used classifications of crime, including the [International Classification of Crime for Statistical Purposes](https://www.unodc.org/documents/data-and-analysis/statistics/crime/ICCS/ICCS_Draft_for_consultation_August_2014.pdf) developed by the United Nations Office of Drugs and Crime and, as a second source, the Chicago Police Department - Illinois Uniform Crime Reporting (IUCR) codes. 

```{r, echo=FALSE}

## Loading Illinois Uniform Crime Reporting (IUCR) codes
##CrimeCodes <- import("https://data.cityofchicago.org/resource/c7ck-438e.json")

```


#### Violent/Non-violent

First, we distinguish between violent and non-violent crime. Based on our data from the City of Chicago dataset, this includes the following crime types. 

| Crime Type | Description |
|------------|-------------|
|"ASSAULT"|Intentional  or  reckless  application  of  physical force  inflicted  upon the body of a person resulting in serious bodily injury.|
|"BATTERY"|See Assault.
|"CRIM SEXUAL ASSAULT"|Unwanted sexual act, attempt to obtain a sexual act, or contact or communication with unwanted sexual attention not amounting to rape. (Inflicted upon a person with force)|
|"HOMICIDE"|Unlawful  death  inflicted  upon  a  person with  the  intent  to  cause death or serious injury.|
|"KIDNAPPING"|Unlawful detainment and taking away of a person or persons against their will (including through the use of   force, threat, fraud or enticement)|
|"OFFENSE INVOLVING CHILDREN"|Police IUCR coding indicates predominantely violent character.|
|"ROBBERY"|Unlawful taking or obtaining property with the use of force or threat of   force.|

```{r Creating Violent Dummy, echo=FALSE}

##creating a dummy variable for violent and non-violent crime (violent = 1)

Crime_Data$violent <- ifelse(Crime_Data$Primary.Type=="ASSAULT" | Crime_Data$Primary.Type=="BATTERY" | Crime_Data$Primary.Type=="CRIM SEXUAL ASSAULT" | Crime_Data$Primary.Type=="HOMICIDE" | Crime_Data$Primary.Type=="KIDNAPPING" | Crime_Data$Primary.Type=="OFFENSE INVOLVING CHILDREN" | Crime_Data$Primary.Type=="ROBBERY", 1,0)

```

#### Persons/Property

Second, we create a category which distinguishes between crimes directed predominately against persons and those focusing on property. This pertains especially to theft but also includes non-personal crimes like vandalism. 

| Crime Type | Description |
|------------|-------------|
|"ARSON"|Willful destruction, damage, or defacement of property.|
|"BURGLARY"|Gaining unauthorized access to a part of a building or other premises, with the intent to commit theft.|
|"CRIMINAL DAMAGE"|Intentional destruction, damage, or defacement of public property.|
|"CRIMINAL TRESPASS"|Unlawful  appropriation  of   property;  squatting;   unlawful acquisition  of  housing  or  land; criminal  trespass|
|"THEFT"|Unlawful   taking   or   obtaining   of   property   with   the   intent   to permanently   deprive   it   from   a   person   or   organization   without consent  and  without  the  use  of  force,  threat  of  force  or  violence, coercion or deception. |
|"MOTOR VEHICLE THEFT"|See theft.|


```{r Creating Property Dummy, echo=FALSE}

##creating a dummy variable for crime directed at person or property (property = 1)

Crime_Data$property <- ifelse(Crime_Data$Primary.Type=="ARSON" | Crime_Data$Primary.Type=="BURGLARY" | Crime_Data$Primary.Type=="CRIMINAL DAMAGE" | Crime_Data$Primary.Type=="CRIMINAL TRESPASS" | Crime_Data$Primary.Type=="THEFT" | Crime_Data$Primary.Type=="MOTOR VEHICLE THEFT", 1,0)

```

#### Money/Non-money

Third, we differentiate whether there is a significant monetary incentive involved in perpetrating the crime. This is, of course, difficult to ascertain on the basis of crime types. We, however, focus on crime types where money represents a significant motivation, e.g. in prostitution. 

| Crime Type | Description |
|------------|-------------|
|"PROSTITUTION "|Acts contrary to accepted public order sexual standards on prostitution.|
|"NARCOTICS"|Unlawful   handling, possession   or   use   of controlled drugs   or precursors for    personal    consumption    and    for    non-personal consumption.|
|"THEFT"|Unlawful   taking   or   obtaining   of   property   with   the   intent   to permanently   deprive   it   from   a   person   or   organization   without consent  and  without  the  use  of  force,  threat  of  force  or  violence, coercion or deception. |
|"MOTOR VEHICLE THEFT"|See theft.|
|"THEFFT"|Unwanted sexual act, attempt to obtain a sexual act, or contact or communication with unwanted sexual attention not amounting to rape. (Inflicted upon a person with force)|
|"DECEPTIVE PRACTICE"|Obtaining  money  or  other  benefit  or  evading  a  liability through deceit or dishonest conduct.|
|"GAMBLING"|Acts  against  regulations, restrictions  or  prohibitions  on  betting  and gambling.|


```{r Creating Money Dummy, echo=FALSE}

##creating a dummy variable for money component (money-related = 1)

Crime_Data$money <- ifelse(Crime_Data$Primary.Type=="PROSTITUTION" | Crime_Data$Primary.Type=="NARCOTICS" | Crime_Data$Primary.Type=="THEFT" | Crime_Data$Primary.Type=="MOTOR VEHICLE THEFT" | Crime_Data$Primary.Type=="DECEPTIVE PRACTICE" | Crime_Data$Primary.Type=="GAMBLING", 1,0)

```


#### Creating individual crime dummies 

In addition, we also create additional dummies for individual crime types. These will be used to test whether specific crimes are are reported more often at the district borders than closer to the district center/the polics station. 

```{r Creating Prostitution Dummy, echo=FALSE}

##creating a dummy variable for money component (money-related = 1)

Crime_Data$Prostitution <- ifelse(Crime_Data$Primary.Type=="PROSTITUTION", 1,0)

Crime_Data$Narcotics <- ifelse(Crime_Data$Primary.Type=="NARCOTICS", 1,0)

Crime_Data$Gambling <- ifelse(Crime_Data$Primary.Type=="GAMBLING", 1,0)

Crime_Data$Arson <- ifelse(Crime_Data$Primary.Type=="ARSON", 1,0)

```


### Regression 

We rely on a regression in order to test whether the location of the police station and the delineation of police districts in the city has an effect on the spatial distribution of crime in Chicago. 

Our dependent variable is the occurence of specific crimes. First, we will rely on the categories established above and test whether the location of police stations and district borders has a statistically significant effect on the spatial distribution of crime categories. Second, we  will look at the occurence of crime types and individual crimes.

Independent variables are the distance to the main district police station as well as the distance to the police district borders. In addition, we have to control for the specific characteristics of the police districts in question that affect crime. Economic and demographic factors in each city area must be considered. The Data Portal of the City of Chicago includes Census data that is aggregated on the community level which allows us to control for a number of socioeconomic effects on crime. We especially rely on the so-called "hardship index" that represents a weighted index of six socioeconomic variables (percent of housing crowded, percent households below poverty line, percentage aged 16+ unemployed, percentage aged 25+ without highschool diploma, percentage aged under 18 or over 64, per capita income).  

#### Model 1.1 - Probability of Violent Crimes occuring Far Away from the Police Station  

This model calculates the probability of a crime occuring far away from the police station depending on it being a violent crime. The dependent variable is our dummy variable "Far", which distinguishes between crimes that are committed inside and outside the circle drawn around the police station. To explain the variation in the dependent variable, this model includes the hardship index, which covers six socioeconomic indicators, and our dummy variable violent, which determines whether the crime included the application of violence, as dependent variables. For a summary of the results, please see **Table 3** and the tables containing fitted values. 

```{r violent_probit1, echo=FALSE}

##VIOLENT
## Regression 
violent_probit1 <- glm(far ~ as.integer(hardship_index) + as.factor(violent), family=binomial(link="probit"), data=Crime_Data)

## Creating Fitted Values for the Regression 
fitted11 <- with(Crime_Data, data.frame(hardship_index=mean(as.integer(hardship_index)), violent = factor(0:1))) 
fitted11$predicted <- predict(violent_probit1, newdata = fitted11, type = 'response', interval='confidence')
kable(fitted11, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values')

```

For each Model, fitted values are created. This is necessary because the calculated coefficients in Probit models do not represent the marginal effects of a change in the independent variable on the dependent variable. To create the fitted values, we use the mean of the hardship index. As a result, we can show the effect that a crime being violent or non-violent - according to our definition presented above - has on its probability of being perpetrated/reported inside our outside of the circle around the police station. This gives us an indication of whether violent crimes are primarily perpetrated closer or farther away from the police station, i.e. whether the police station has an effect on crime. 

#### Model 1.2 - Probability of Crimes directed at Property occuring Far Away from the Police Station 

This model replaces the variable "violent" with the dummy for "property-related".

```{r property_probit1, echo=FALSE}

## PROPERTY
property_probit1 <- glm(far ~ as.integer(hardship_index) + as.factor(property), family=binomial(link="probit"), data=Crime_Data)
fitted12 <- with(Crime_Data, data.frame(hardship_index=mean(as.integer(hardship_index)), property = factor(0:1))) 
fitted12$predicted <- predict(property_probit1, newdata = fitted12, type = 'response', interval='confidence')
kable(fitted12, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values')

```

As the fitted values show, the model does not predict huge differences in the probability of a crime falling inside or outside of the circle depending on it being violent or property-related. 

#### Model 1.3 - Probability of Crimes including a occuring Far Away from the Police Station

This model replaces the dummy for "property-related" with the third category, which states that the crime includes a significant monetary component/incentive. This allows different interpretations. First, or independent variables may not have huge explanatory potential with regard to th

```{r money_probit1, echo=FALSE}

## MONEY
money_probit1 <- glm(far ~ as.integer(hardship_index) + as.factor(money), family=binomial(link="probit"), data=Crime_Data)
fitted13 <- with(Crime_Data, data.frame(hardship_index=mean(as.integer(hardship_index)), money = factor(0:1))) 
fitted13$predicted <- predict(money_probit1, newdata = fitted13, type = 'response', interval='confidence')
kable(fitted13, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values')

```

#### Summary Model 1 

**Table 3** shows ... 

**Table 3***
```{r Stargazer Table 1, echo=FALSE, results='asis'}

## Create covariate labels
labels <- c('Hardship Index', 'Violent Dummy',
            'Property Dummy', 'Money Dummy')

##Using stargazer, we create a table that summarizes the results of the Models 1.1 to 1.3. 
stargazer::stargazer(violent_probit1, property_probit1, money_probit1, covariate.labels = labels,
    title = 'Probit Regression Estimates of Model 1.1 to 1.3',
    digits = 2, type = 'html')

## Second stargazer table for fitted values 

labelsfitted <- c('Hardship Index', 'Violent', 'Property', 'Money')

stargazer::stargazer(fitted11, fitted12, fitted13, covariate.labels = labelsfitted,
    title = 'Logistic Regression Estimates of Model 1.1 to 1.3',
    digits = 2, type = 'html')



```


#### Model 2.1 - Socioeconomic indicators and Violent Crime as Predictors for the Distribution of Crime 

The second model substitutes the "hardship index" for its individual components and ... 


```{r violent_probit2, echo=FALSE}

## VIOLENT

violent_probit2 <- glm(far ~ as.integer(per_capita_income_) + as.integer(percent_aged_16_unemployed) + as.integer(percent_households_below_poverty) + as.integer(percent_aged_25_without_high_school_diploma)+ as.integer(percent_of_housing_crowded) + as.integer(percent_aged_under_18_or_over_64) + as.factor(violent), family=binomial(link="probit"), data=Crime_Data)

fitted2 <- with(Crime_Data, data.frame(per_capita_income_=mean(as.integer(per_capita_income_)), percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)), percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)), percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)), percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)), percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), violent = factor(0:1)))
fitted2$predicted <- predict(violent_probit2, newdata = fitted2, type = 'response', interval='confidence')

coltable3 <- c('PerCapitaIncome', '16+Unemployed%','HouseholdsPoverty%','25+WithoutHighSchool%', 'HousingCrowded%', 'Under18Over64%', 'Violent', 'predicted')
kable(fitted2, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values', col.names=coltable3)

```


#### Model 2.2 - Socioeconomic Indicators and Crimes directed at Property

```{r property_probit2, echo=FALSE}

## Property

property_probit2 <- glm(far ~ as.integer(per_capita_income_) + as.integer(percent_aged_16_unemployed) + as.integer(percent_households_below_poverty) + as.integer(percent_aged_25_without_high_school_diploma)+ as.integer(percent_of_housing_crowded) + as.integer(percent_aged_under_18_or_over_64) + as.factor(property), family=binomial(link="probit"), data=Crime_Data)

fitted2 <- with(Crime_Data, data.frame(per_capita_income_=mean(as.integer(per_capita_income_)), percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)), percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)), percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)), percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)), percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), property = factor(0:1)))
fitted2$predicted <- predict(property_probit2, newdata = fitted2, type = 'response', interval='confidence')


coltable4 <- c('PerCapitaIncome', '16+Unemployed%','HouseholdsPoverty%','25+WithoutHighSchool%', 'HousingCrowded%', 'Under18Over64%', 'Property', 'predicted')
kable(fitted2, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values', col.names=coltable4)

```

#### Model 2.3 - Socioeconomic Indicators and Money-related 

```{r money_probit2, echo=FALSE}

## MONEY

money_probit2 <- glm(far ~ as.integer(per_capita_income_) + as.integer(percent_aged_16_unemployed) + as.integer(percent_households_below_poverty) + as.integer(percent_aged_25_without_high_school_diploma)+ as.integer(percent_of_housing_crowded) + as.integer(percent_aged_under_18_or_over_64) + as.factor(money), family=binomial(link="probit"), data=Crime_Data)

fitted2 <- with(Crime_Data, data.frame(per_capita_income_=mean(as.integer(per_capita_income_)), percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)), percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)), percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)), percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)), percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), money = factor(0:1)))
fitted2$predicted <- predict(money_probit2, newdata = fitted2, type = 'response', interval='confidence')


coltable5 <- c('PerCapitaIncome', '16+Unemployed%','HouseholdsPoverty%','25+WithoutHighSchool%', 'HousingCrowded%', 'Under18Over64%', 'Money', 'predicted')
kable(fitted2, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values', col.names=coltable5)

```


#### Summary Model 2

```{r Stargazer Table 2, echo=FALSE, results='asis'}

## Create covariate labels
labels2 <- c('Per Capita Income', 'Percent Aged 16+ Unemployed', 'Percent Households below Poverty Line', 'Percent Aged 25 without High School Diploma', 'Percent of Housing Crowded', 'Percent Aged under 18 or over 64', 'Violent Dummy', 'Property Dummy', 'Money Dummy')

##Using stargazer, we create a table that summarizes the results of the Models 2.1 to 2.3. 
stargazer::stargazer(violent_probit2, property_probit2, money_probit2, covariate.labels = labels2,
    title = 'Probit Regression Estimates of Model 2.1 to 2.3',
    digits = 2, type = 'html')

```


### Model 3 - Analysis for Individual Crimes

#### Spatial Distribution: Prostitution Crime

```{r Prostitution_probit3, echo=FALSE}

Prostitution_probit3 <- glm(far ~ as.integer(per_capita_income_) + as.integer(percent_aged_16_unemployed) + as.integer(percent_households_below_poverty) + as.integer(percent_aged_25_without_high_school_diploma)+ as.integer(percent_of_housing_crowded) + as.integer(percent_aged_under_18_or_over_64) + as.factor(Prostitution), family=binomial(link="probit"), data=Crime_Data)

fitted3 <- with(Crime_Data, data.frame(per_capita_income_=mean(as.integer(per_capita_income_)), percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)), percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)), percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)), percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)), percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), Prostitution = factor(0:1)))
fitted3$predicted <- predict(Prostitution_probit3, newdata = fitted3, type = 'response', interval='confidence')

coltable6 <- c('PerCapitaIncome', '16+Unemployed%','HouseholdsPoverty%','25+WithoutHighSchool%', 'HousingCrowded%', 'Under18Over64%', 'Prostitution', 'predicted')

kable(fitted3, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values', col.names=coltable6)

```

The significant difference in predicted probabilities for prositution crime indicates a spatial distribution of this crime type that is different from other crimes. **Figure x** shows that prostitution crimes are indeed clustered in around specific locations. 

```{r Map Prostitution & Gambling crime, echo=FALSE, warnings = FALSE, error=FALSE, eval=FALSE}
## Clustered crimes 

locationData <- subset(Crime_Data, Primary.Type == "PROSTITUTION" | Primary.Type == "GAMBLING" )

ChicagoMap2 <- qmap("Chicago", zoom = 11, maptype = "toner", source = "stamen")
                   
##ChicagoMap <- get_map(location = c(lon = -87.6747987, lat = 41.9654501), zoom = 10, maptype = "toner", source = "stamen")

FinalMap <- ChicagoMap2 +
                geom_point(aes(x = Longitude, y = Latitude, colour = Primary.Type),
                data = locationData) +
                #geom_point(aes(x = stations$coords.x1, y = stations$coords.x2), data = stations) +
                xlab('') + ylab('') +
                theme(axis.ticks = element_blank(), 
                      axis.text.x = element_blank(),
                      axis.text.y = element_blank()) + 
                guides(size = guide_legend(title = 'Crime Type'),
                       colour = guide_legend(title = 'Crime Type'))
print(FinalMap)

## we want to add location of police station, district borders and our circle to this map
```


#### Spatial Distribution: Narcotics Crime 

```{r Narcotics_probit3, echo=FALSE}

Narcotics_probit3 <- glm(
  far ~ as.integer(per_capita_income_) + 
    as.integer(percent_aged_16_unemployed) + 
    as.integer(percent_households_below_poverty) + 
    as.integer(percent_aged_25_without_high_school_diploma)+ 
    as.integer(percent_of_housing_crowded) + 
    as.integer(percent_aged_under_18_or_over_64) + 
    as.factor(Narcotics), 
  family=binomial(link="probit"), data=Crime_Data
  )

fitted3 <- with(Crime_Data, data.frame(
  per_capita_income_=mean(as.integer(per_capita_income_)),
  percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)),
  percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)),
  percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)),
  percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)),
  percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), 
  Narcotics = factor(0:1))
  )

fitted3$predicted <- predict(Narcotics_probit3, newdata = fitted3, type = 'response', interval='confidence')

## creating output (fitted)
coltable7 <- c('PerCapitaIncome', '16+Unemployed%','HouseholdsPoverty%','25+WithoutHighSchool%', 'HousingCrowded%', 'Under18Over64%', 'Narcotics', 'predicted')
kable(fitted3, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values', col.names=coltable7)

```

#### Spatial Distribution: Gambling Crime 

```{r Gambling_probit3, echo=FALSE}

Gambling_probit3 <- glm(far ~ as.integer(per_capita_income_) + as.integer(percent_aged_16_unemployed) + as.integer(percent_households_below_poverty) + as.integer(percent_aged_25_without_high_school_diploma)+ as.integer(percent_of_housing_crowded) + as.integer(percent_aged_under_18_or_over_64) + as.factor(Gambling), family=binomial(link="probit"), data=Crime_Data)

fitted3 <- with(Crime_Data, data.frame(per_capita_income_=mean(as.integer(per_capita_income_)), percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)), percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)), percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)), percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)), percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), Gambling = factor(0:1)))
fitted3$predicted <- predict(Gambling_probit3, newdata = fitted3, type = 'response', interval='confidence')

coltable8 <- c('PerCapitaIncome', '16+Unemployed%','HouseholdsPoverty%','25+WithoutHighSchool%', 'HousingCrowded%', 'Under18Over64%', 'Gambling', 'predicted')
kable(fitted3, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values', col.names=coltable8)

```

#### Spatial Distribution: Arson 

```{r Arson_probit3, echo=FALSE}

Arson_probit3 <- glm(far ~ as.integer(per_capita_income_) + as.integer(percent_aged_16_unemployed) + as.integer(percent_households_below_poverty) + as.integer(percent_aged_25_without_high_school_diploma)+ as.integer(percent_of_housing_crowded) + as.integer(percent_aged_under_18_or_over_64) + as.factor(Arson), family=binomial(link="probit"), data=Crime_Data)

fitted3 <- with(Crime_Data, data.frame(per_capita_income_=mean(as.integer(per_capita_income_)), percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)), percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)), percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)), percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)), percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), Arson = factor(0:1)))
fitted3$predicted <- predict(Arson_probit3, newdata = fitted3, type = 'response', interval='confidence')
kable(fitted3, align = 'c', digits = 3, caption = 'Predicted Probabilities for Fitted Values')

```

#### Summary Model 3 

```{r Stargazer Table 3, echo=FALSE, results='asis'}

## Create covariate labels
labels3 <- c('Per Capita Income', 'Percent Aged 16+ Unemployed', 'Percent Households below Poverty Line', 'Percent Aged 25 without High School Diploma', 'Percent of Housing Crowded', 'Percent Aged under 18 or over 64', 'Prostitution Dummy', 'Narcotics Dummy', 'Gambling Dummy', 'Arson Dummy')

##Using stargazer, we create a table that summarizes the results of the Models 3.1 to 3.3. 
stargazer::stargazer(Prostitution_probit3, Narcotics_probit3, Gambling_probit3, Arson_probit3, covariate.labels = labels3,
    title = 'Probit Regression Estimates of Model 3.1 to 3.4',
    digits = 2, type = 'html')

```



### Model 4 

Given the occurence of clustered crimes like prostitution, we assume that these observations could bias our overall estimates for the crime categories. Therefore, we exclude prostitution and gambling crimes and run the probit model again. 

```{r ClusteredDataProbit, echo=FALSE}

##Excluding clustered crimes

Crime_DataWithoutClusters <- subset(Crime_Data, Primary.Type != "PROSTITUTION" | Primary.Type != "GAMBLING" )

##VIOLENT

Violent_probit4 <- glm(far ~ as.integer(per_capita_income_) + as.integer(percent_aged_16_unemployed) + as.integer(percent_households_below_poverty) + as.integer(percent_aged_25_without_high_school_diploma)+ as.integer(percent_of_housing_crowded) + as.integer(percent_aged_under_18_or_over_64) + as.factor(violent), family=binomial(link="probit"), data=Crime_DataWithoutClusters)

fitted41 <- with(Crime_DataWithoutClusters, data.frame(
  per_capita_income_=mean(as.integer(per_capita_income_)),
  percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)),
  percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)),
  percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)),
  percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)),
  percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), 
  violent = factor(0:1))
  )

fitted41$predicted <- predict(Violent_probit4, newdata = fitted41, type = 'response', interval='confidence')

##PROPERTY

Property_probit4 <- glm(far ~ as.integer(per_capita_income_) + as.integer(percent_aged_16_unemployed) + as.integer(percent_households_below_poverty) + as.integer(percent_aged_25_without_high_school_diploma)+ as.integer(percent_of_housing_crowded) + as.integer(percent_aged_under_18_or_over_64) + as.factor(property), family=binomial(link="probit"), data=Crime_DataWithoutClusters)

fitted42 <- with(Crime_DataWithoutClusters, data.frame(
  per_capita_income_=mean(as.integer(per_capita_income_)),
  percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)),
  percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)),
  percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)),
  percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)),
  percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), 
  property = factor(0:1))
  )

fitted42$predicted <- predict(Property_probit4, newdata = fitted42, type = 'response', interval='confidence')


##MONEY

Money_probit4 <- glm(far ~ as.integer(per_capita_income_) + as.integer(percent_aged_16_unemployed) + as.integer(percent_households_below_poverty) + as.integer(percent_aged_25_without_high_school_diploma)+ as.integer(percent_of_housing_crowded) + as.integer(percent_aged_under_18_or_over_64) + as.factor(money), family=binomial(link="probit"), data=Crime_DataWithoutClusters)

fitted43 <- with(Crime_DataWithoutClusters, data.frame(
  per_capita_income_=mean(as.integer(per_capita_income_)),
  percent_aged_16_unemployed=mean(as.integer(percent_aged_16_unemployed)),
  percent_households_below_poverty=mean(as.integer(percent_households_below_poverty)),
  percent_aged_25_without_high_school_diploma=mean(as.integer(percent_aged_25_without_high_school_diploma)),
  percent_of_housing_crowded=mean(as.integer(percent_of_housing_crowded)),
  percent_aged_under_18_or_over_64=mean(as.integer(percent_aged_under_18_or_over_64)), 
  money = factor(0:1))
  )

fitted43$predicted <- predict(Money_probit4, newdata = fitted43, type = 'response', interval='confidence')
```


```{r ClusteredDataProbit Stargazer, echo=FALSE, results='asis'}
## Create covariate labels
labels4 <- c('Per Capita Income', 'Percent Aged 16+ Unemployed', 'Percent Households below Poverty Line', 'Percent Aged 25 without High School Diploma', 'Percent of Housing Crowded', 'Percent Aged under 18 or over 64', 'Violent Dummy', 'Property Dummy', 'Money Dummy')

##Using stargazer, we create a table that summarizes the results of the Models 4.1 to 4.3. 
stargazer::stargazer(Violent_probit4, Property_probit4, Money_probit4, covariate.labels = labels4,
    title = 'Probit Regression Estimates of Model 4.1 to 4.3',
    digits = 2, type = 'html')

```


### Model 5 - Linear Regression Model: Absolute Distances

Because the Probit models show only relatively small differences in crime locations, we try a linear regression model that relies on the absolute distance as the dependent variable. 

```{r Linear Regression Absolute Distance, echo=FALSE}

## Linear Models with Absolute Distances 

Violent_linear1 <- lm(distance_sta ~ as.integer(hardship_index) + as.factor(violent), data=Crime_Data )

Property_linear1 <- lm(distance_sta ~ as.integer(hardship_index) + as.factor(property), data=Crime_Data )

Money_linear1 <- lm(distance_sta ~ as.integer(hardship_index) + as.factor(money), data=Crime_Data )

```

...

```{r Linear Models Stargazer, echo=FALSE, results='asis'}
## Create covariate labels
labelsLinear1 <- c('Hardship Index', 'Violent Dummy', 'Property Dummy', 'Money Dummy')

##Using stargazer, we create a table that summarizes the results of the Models 5.1 to 5.3. 
stargazer::stargazer(Violent_linear1, Property_linear1, Money_linear1, covariate.labels = labelsLinear1,
    title = 'Linear Regression Estimates of Model 5.1 to 5.3',
    digits = 2, type = 'html')

```

### Model 6 - Linear Regression Model: Absolute Distances for Individual Crimes 

```{r Linear Regression Absolute Distance Ind. Crimes, echo=FALSE}

## Linear Reg for individual Crimes 

Prostitution_linear2 <- lm(distance_sta ~ as.integer(hardship_index) + as.factor(Prostitution), data=Crime_Data )

Gambling_linear2 <- lm(distance_sta ~ as.integer(hardship_index) + as.factor(Gambling), data=Crime_Data )

```

...

```{r Linear Models Stargazer Ind. Files, echo=FALSE, results='asis'}
## Create covariate labels
labelsLinear2 <- c('Hardship Index', 'Prostitution Dummy', 'Gambling Dummy')

##Using stargazer, we create a table that summarizes the results of the Models 6.1 to 6.3. 
stargazer::stargazer(Prostitution_linear2, Gambling_linear2, covariate.labels = labelsLinear2,
    title = 'Linear Regression Estimates of Model 6.1 to 6.3',
    digits = 2, type = 'html')

```




## Conclusion 

...


## Bibliography 


